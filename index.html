<script>
document.getElementById("csvFile").addEventListener("change", function(e) {

  const file = e.target.files[0];
  if (!file) return;

  const reader = new FileReader();

  reader.onload = function() {
    const lines = reader.result.split(/\r?\n/);
    const tbody = document.querySelector("#resultTable tbody");
    tbody.innerHTML = "";

    for (let i = 1; i < lines.length; i++) {
      if (!lines[i]) continue;

      const c = lines[i].split(",");

      const name = c[2]; // C列 商品名

      // --- 各倉庫計算 ---
      const tokyo   = (c[8]  || 0) - ((+c[5])  + (+c[6])  + (+c[7])  + (+c[11]) + (+c[12]));
      const osaka   = (c[18] || 0) - ((+c[15]) + (+c[17]) + (+c[20]) + (+c[21]));
      const nagoya  = (c[27] || 0) - ((+c[24]) + (+c[25]) + (+c[28]) + (+c[29]));
      const fukuoka = (c[35] || 0) - ((+c[32]) + (+c[33]) + (+c[36]) + (+c[37]));
      const ryugasaki = (c[42] || 0) - ((+c[40]) + (+c[41]) + (+c[43]) + (+c[44]));
      const hokkaido = (c[50] || 0) - ((+c[47]) + (+c[48]) + (+c[50]) + (+c[51]) + (+c[52]));
      const other  = (c[58] || 0) - ((+c[55]) + (+c[56]) + (+c[57]) + (+c[59]) + (+c[60]));

      const need =
        tokyo <= 1 || osaka <= 1 || nagoya <= 1 ||
        fukuoka <= 1 || ryugasaki <= 1 ||
        hokkaido <= 1 || other <= 1;

      const tr = document.createElement("tr");
      if (need) tr.classList.add("need");

      tr.innerHTML = `
        <td>${name}</td>
        <td>${tokyo}</td>
        <td>${osaka}</td>
        <td>${nagoya}</td>
        <td>${fukuoka}</td>
        <td>${ryugasaki}</td>
        <td>${hokkaido}</td>
        <td>${other}</td>
      `;

      tbody.appendChild(tr);
    }
  };

  reader.readAsText(file, "UTF-8");
});
</script>

